<?xml version="1.0" encoding="UTF-8"?>
<project name="VCS git tagging">
    
  <target name="-diff" if="vcsgit">
    <exec executable="git" failonerror="true" output="${output}" outputproperty="diff">
      <arg value="diff"/>
      <arg value="--name-status"/>
      <arg value="HEAD"/>
    </exec>
    <fail message="Not all changes commited.">
      <condition>
        <or>
          <not>
            <equals arg1="${diff}" arg2=""/>
          </not>
        </or>
      </condition>
    </fail>
    <echo message="All changes commited. ${diff}"/>
  </target>

  <target name="-info" if="vcsgit">
    <exec executable="git" failonerror="false" output="${output}" outputproperty="info">
      <arg value="ls-remote"/>
      <arg value="--tags"/>
    </exec>
    <fail message="Version exist.">
      <condition>
        <contains string="${info}" substring="${version}"/>
      </condition>
    </fail>
    <echo message="Version ${version} not exist."/>
  </target>

  <target name="-copy" if="vcsgit">
    <exec executable="git" failonerror="false" output="${output}" outputproperty="tag">
      <arg value="tag"/>
      <arg value="-a"/>
      <arg value="${version}"/>
      <arg value="-m"/>
      <arg value="Creating a new project tag."/>
    </exec>
    <echo message="${tag}"/>
    <exec executable="git" failonerror="false" output="${output}" outputproperty="copy">
      <arg value="push"/>
      <arg value="origin"/>
      <arg value="${version}"/>
    </exec>
    <echo message="${copy}"/>
  </target>

  <target name="-commit" if="vcsgit">
    <exec executable="git" failonerror="true" output="${output}" outputproperty="commit-local">
      <arg value="commit"/>
      <arg value="-am"/>
      <arg value="Commit the new dev config."/>
    </exec>
    <echo message="The configuration file is commited."/>
    <exec executable="git" failonerror="false" output="${output}" outputproperty="commit">
      <arg value="push"/>
    </exec>
    <echo message="The configuration file is pushed."/>
  </target>

</project>
